# FrontendEnv

## 概要

モダンな js が動作するフロントエンドエンジニア向けの開発環境です。
React.js や Vue.js などを任意で導入し、試すことも簡単にできます。
Node.js が導入されていることが前提なので、Node.js とパッケージマネージャ(npm または yarn)を導入しましょう。
別ブランチ(react-starter,vue-starter)では、それぞれ React+Redux+React-Router のスターターキット、Vue+Vuex+Vue-Router のスターターキットを作っています。

## 使用方法

git clone したらディレクトリ内で以下のコマンドを打つと使えます。

```
yarn install
yarn start
```

## 環境構築

### 作業ディレクトリ作成

```
mkdir [workspace-name]
cd [workspace-name]
```

### git と npm の初期化

git init で git リポジトリとして扱えるようになります。
yarn init ではそのプロダクトの情報を聞かれ、最終的には package.json と呼ばれるディレクトリ内でのパッケージやコマンドを管理するファイルが生成されます。

```
git init
yarn init
```

### gitignore と editorconfig の追加

gitignore は指定したファイルを git の管理下から除外するためのものです。
editorconfig はいろんなエディタ間でのルール（インデントやタブ・スペースなど）を統一させるファイルです。

```
touch .gitignore
touch .editorconfig
```

.gitignore

gitignore に関しては Nuxt.js3.0 の `create-nuxt-app`コマンドで自動生成される、ignore ファイルを使用します。

```
# Created by .ignore support plugin (hsz.mobi)
### Node template
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# Runtime data
pids
*.pid
*.seed
*.pid.lock

# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov

# Coverage directory used by tools like istanbul
coverage

# nyc test coverage
.nyc_output

# Grunt intermediate storage (http://gruntjs.com/creating-plugins#storing-task-files)
.grunt

# Bower dependency directory (https://bower.io/)
bower_components

# node-waf configuration
.lock-wscript

# Compiled binary addons (https://nodejs.org/api/addons.html)
build/Release

# Dependency directories
node_modules/
jspm_packages/

# TypeScript v1 declaration files
typings/

# Optional npm cache directory
.npm

# Optional eslint cache
.eslintcache

# Optional REPL history
.node_repl_history

# Output of 'npm pack'
*.tgz

# Yarn Integrity file
.yarn-integrity

# dotenv environment variables file
.env

# parcel-bundler cache (https://parceljs.org/)
.cache

# next.js build output
.next

# nuxt.js build output
.nuxt

# Nuxt generate
dist

# vuepress build output
.vuepress/dist

# Serverless directories
.serverless

# IDE
.idea

#editor
.vscode

#mac
.DS_Store

#others
package-lock.json
yarn.lock
sw.*

```

.editorconfig

```
root = true


[*]

indent_style = tab
indent_size = 2

end_of_line = lf
charset = utf-8
trim_trailing_whitespace = true
insert_final_newline = true

[*.md]
trim_trailing_whitespace = false
```

### flowtype の設定

flowtype は変数に肩の指定がいらない世界の javascript に型を導入することで、コード内の変数の値の型をチェックすることができます。
最初に flowtype で使用するパッケージを導入します。

```
yanr add dev flowtype flow-bin babel-plugin-transform-flow-strip-types
```

次に以下のコマンドで.flowconfig のファイルを生成します。

```
flow init
```

次に.flowconfig のファイルを編集します。

```
[ignore]
.*/node_modules/.*
.*/dest/.*

[include]

[libs]
./src

[lints]

[options]
```

それに合わせて、package.json の内容も編集します。

```
// scriptsに記述
"flow": "$(npm bin)/flow",

// babelに記述
"plugins": [
 "babel-plugin-transform-flow-strip-types"
 ]
```

### ES6 と ESLint と Prettier

ES6(ECMAscript)と呼ばれる新しいタイプの javascript が使えるようにします。
ESLint を使うとコードの一貫性を保つことができたり、潜在的なエラーを見つけ出したりととても便利です。
prettier でコードを自動的に適切な形にフォーマットしてくれます。
ちなみにエディタで prettier と ESLint の設定も必要です

```
yarn add --dev eslint eslint-plugin-import eslint-config-airbnb-base prettier eslint-config-prettier eslint-plugin-prettier
```

こちらも追加で導入しましょう。

```
yarn add --dev eslint-config-airbnb eslint-plugin-flowtype eslint-plugin-import eslint-plugin-jsx-a11y
```

.eslintrc.js のファイルに以下を記述します

```
module.exports = {
    "parser": "babel-eslint",
    "extends": [
      "airbnb",
      "prettier",
      "plugin:flowtype/recommended"
    ],
    "plugins": [
      "prettier"
    ],
    "rules": {
      "prettier/prettier": ["error", {
        "singleQuote": true,
        "bracketSpacing": true,
        "jsxBracketSameLine": true
      }]
    }
  };
```

Lint 用のショートカットコマンドを package.json 内の scripts に追加します。

```
"lint": "eslint \"src/**/*.js\"",
"lint-fix": "eslint \"src/**/*.js\" --fix",
```

### babel の設定

javacsript の新しい書き方は、ブラウザによって認識されない場合があるので認識できる形にトランスパイルしてくれる便利屋さんが babel。

```
yarn add --dev babel babel-core babel-eslint babel-loader babel-preset-env babel-preset-stage2
```

### webpack の設定

webpack は指定したディレクトリ内のリソース（js ファイルや img,css など）をひとまとめにし、実行時に単一ファイルとして書き出してくれる。
webpack-dev-server で開発用サーバーを立ち上げブラウザすぐに確認することもできる。

```
yarn add --dev webpack webpack-dev-server webpack-cli
```

webpack.config.js の編集

```
const path = require('path');

module.exports = {
  mode: 'development',
  entry: [
    'babel-polyfill',
    path.resolve('src', 'index.js')
  ],
  output: {
    filename: 'bundle.js',
    path: path.join(__dirname, 'dest/')
  },
  module: {
    rules: [
      {
        test: /\.js$/,
        exclude: /node_modules/,
        loader: 'babel-loader',
      },
    ]
  },
  resolve: {
    extensions: ['.js','json','jsx'],
    alias: {
      vue$: 'vue/dist/vue.esm.js',
    },
  },
  devServer: {
    contentBase: 'dest',
  },
};
```

css やその他ファイルも読めるようにしましょう。

```
yarn add --dev node-sass css-loader sass-loader style-loader url-loader
```

webpack.config.js の rules に loader を追記しましょう。

```
{
  test: /\.(css|sass|scss)$/,
  loader: 'sass-loader',
  options: {
    outputStyle: 'expanded',
    sourceMap: true,
  },
},
{
  test: /\.(jpg|png|json|svg)$/,
  loaders: 'url-loader'
},
```

webpack のショートカットコマンドが使えるようにするため、package.json の scripts に以下のコードを追加します。

```
"test": "echo \"Error: no test specified\" && exit 1",
"build": "webpack --config ./webpack.config.js",
"start": "webpack-dev-server --config ./webpack.config.js --host 0.0.0.0"
```

babel-polyfill のインストール

```
yarn add babel-polyfill
```

### コンテンツの準備

ソース用と公開用ディレクトリの作成

```
mkdir src //ソース用
mkdir dest //公開用
```

src/index.js

```
import 'babel-polyfill'
import foo from './foo.js'

foo();
```

src/foo.js

```
export default function foo() {
    document.getElementById('app').innerHTML = "Hello world";
}
```

dest/index.html

```
<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <title>Frontend Env App</title>
  </head>
  <body>
    <div id="app"></div>
    <script src="/bundle.js"></script>
  </body>
</html>
```

### webpack の起動

以下、コマンドでブラウザ内でhttp://localhost:8080/ にアクセスしてみて、Hello world のメッセージが出れば完成です。

```
yarn start
```

### 参考 URL

https://github.com/masakitm/vue-nocli  
https://github.com/nabepon/frontend/tree/env-setup-tutorial  
https://ics.media/entry/12140  
https://www.kken.io/posts/prettier-eslint/

上記の記事を参考にさせていただきました。ありがとうございます！
